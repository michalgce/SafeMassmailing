<ui:composition template="index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
        >
    <ui:define name="content">
        <b>Apache SpamAssassin</b> is the #1 Open Source anti-spam platform giving system administrators <br/>
        a filter to classify email and block spam (unsolicited bulk email).<br/>
        It uses a robust scoring framework and plug-ins to integrate a wide range of advanced heuristic and statistical <br/>
        analysis tests on email headers and body text including text analysis, Bayesian filtering, DNS blocklists, and collaborative filtering databases.
        <br/>
        <br/>
        Here you can test your email validity.<br/>
        <h:form>
            <p:editor id="editor" widgetVar="editorWidget" value="#{spamAssassinService.message}" required="true" width="600" /> <br/>
            <p:commandButton icon="ui-icon-info" value="Test message" actionListener="#{spamAssassinService.testMessage}" update=":report :score" ajax="true" />
        </h:form>
        <br/>

        <h:panelGroup id="spamAssassinReportGrid">
            Raport: <h:outputText id="report" value="#{spamAssassinService.spamAssassinResponseDto.report}" styleClass="preformatted" />

            <h3>Spam points: <h:outputText id="score" value="#{spamAssassinService.spamAssassinResponseDto.score}" /></h3>

        </h:panelGroup>

        <p:ajaxStatus style="display:block;margin-bottom:2em;height:24px;">
            <f:facet name="default">
                <h:outputText value="Status: StandBy" />
            </f:facet>

            <f:facet name="complete">
                <h:outputText value="Status: Completed" />
            </f:facet>
        </p:ajaxStatus>

        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />

        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
            <h:graphicImage library="image" name="loading.gif" />
        </p:dialog>

        <!--  Excpetion Handler    -->
        <!-- TODO fix catching exception -->
        <p:ajaxExceptionHandler type="java.lang.IllegalStateException"
                                update="exceptionDialog"
                                onexception="PF('exceptionDialog').show();" />

        <p:dialog id="exceptionDialog" header="Exception '#{pfExceptionHandler.type}' occured!" widgetVar="exceptionDialog"
                  height="500px">
            Message: #{pfExceptionHandler.message} <br/>
            StackTrace: <h:outputText value="#{pfExceptionHandler.formattedStackTrace}" escape="false" /> <br />

            <p:button onclick="document.location.href = document.location.href;"
                      value="Reload!"
                      rendered="#{pfExceptionHandler.type == 'java.lang.IllegalStateException'}" />
        </p:dialog>
    </ui:define>
</ui:composition>